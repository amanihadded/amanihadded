<app-side-bar (toggle)="onSidebarToggle($event)"></app-side-bar>

<div class="main-content" [class.collapsed]="isSidebarCollapsed">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-6">
        <div class="mb-3">
          <h5 class="card-title">Liste des étudiants <span class="text-muted fw-normal ms-2">({{ userCount }})</span></h5>
        </div>
      </div>
      <div class="col-md-6">
        <div class="d-flex flex-wrap align-items-center justify-content-end gap-2 mb-3">
            <div class="ms-3">
                <input type="text" class="form-control" placeholder="Rechercher par nom d'utilisateur" [(ngModel)]="searchTerm" (input)="searchUsers()" />
              </div>
            <div>
            <button class="btn btn-primary" (click)="AjoutModel()">
              <i class="bx bx-plus me-1" style="color: white;"></i> Ajouter
            </button>
          </div>
          
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div class="">
          <div class="table-responsive">
            <table class="table project-list-table table-nowrap align-middle table-borderless">
              <thead>
                <tr>
                  <th scope="col">Nom</th>
                  <th scope="col">Email</th>
                  <th scope="col" style="width: 200px;">Action</th>
                </tr>
              </thead>
               <tbody> 

                <tr *ngFor="let user of filteredUsers">
                    <td>  <img *ngIf="imageMap.has(user.id)" [src]="getImageUrl(imageMap.get(user.id))" alt="" class="avatar-sm rounded-circle me-2" />
                      <a href="#" class="text-body">{{ user.firstname }} {{ user.lastname }}</a></td>
                    <td><span class="badge badge-soft-success mb-0">{{ user.email }}</span></td>
                    <td>
                        <ul class="list-inline mb-0">
                          <li class="list-inline-item">
                            <button class="btn btn-link text-primary p-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit" (click)="editEtudiant(user)">
                              <i class="bx bx-pencil font-size-18"></i>
                            </button>
                          </li>
                          <li class="list-inline-item">
                            <button class="btn btn-link text-danger p-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete" (click)="deleteEtudiant(user)">
                              <i class="bx bx-trash-alt font-size-18"></i>
                            </button>
                          </li>
                          <li class="list-inline-item">
                            <button class="btn btn-link text-info p-0" data-bs-toggle="tooltip" data-bs-placement="top" title="Details" (click)="detailsFormateur(user)">
                              <i class="bx bx-info-circle font-size-18"></i>
                            </button>
                          </li>
                        </ul>
                      </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Ajout Modal -->
<div class="modal fade" id="ajouModel" tabindex="-1" role="dialog" aria-labelledby="ajouModelLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="ajouModelLabel">Ajouter un étudiant</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" (click)="closeEvent()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-xl px-4 mt-4">
          <hr class="mt-0 mb-4">
          <div class="row">
            <div class="col-xl-4">
              <div class="card mb-4 mb-xl-0">
                <div class="card-header">Photo de profil</div>
                <div class="card-body text-center">
                  <img class="img-account-profile rounded-circle mb-2" [src]="selectedFile" alt="">
                  <br><input type="file" class="form-control" (change)="onFileSelected($event)"> <br><br>
                </div>
              </div>
            </div>    
            <div class="col-xl-8">
              <div class="card mb-4">
                <div class="card-header">Détails du Compte</div>
                <div class="card-body">
                  <form [formGroup]="forminput" (ngSubmit)="AjoutEvent()">
                    <div class="row gx-3 mb-3">
                      <div class="col-md-6">
                        <label class="small mb-1" for="firstname">Nom</label>
                        <input class="form-control" id="firstname" formControlName="firstname" placeholder="Entrez nom">
                        <div *ngIf="forminput.get('firstname')?.touched && forminput.get('firstname')?.invalid" class="text-danger">
                          <div *ngIf="forminput.get('firstname')?.errors?.['required']">Le nom est requis.</div>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <label class="small mb-1" for="lastname">Prénom</label>
                        <input class="form-control" id="lastname" formControlName="lastname" placeholder="Entrez prénom">
                        <div *ngIf="forminput.get('lastname')?.touched && forminput.get('lastname')?.invalid" class="text-danger">
                          <div *ngIf="forminput.get('lastname')?.errors?.['required']">Le prénom est requis.</div>
                        </div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="small mb-1" for="username">Nom d'utilisateur</label>
                      <input class="form-control" id="username" formControlName="username" placeholder="Entrez nom d'utilisateur">
                      <div *ngIf="forminput.get('username')?.touched && forminput.get('username')?.invalid" class="text-danger">
                        <div *ngIf="forminput.get('username')?.errors?.['required']">Le nom d'utilisateur est requis.</div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="small mb-1" for="email">Email</label>
                      <input class="form-control" id="email" formControlName="email" placeholder="Entrez adresse email">
                      <div *ngIf="forminput.get('email')?.touched && forminput.get('email')?.invalid" class="text-danger">
                        <div *ngIf="forminput.get('email')?.errors?.['required']">L'email est requis.</div>
                        <div *ngIf="forminput.get('email')?.errors?.['email']">L'email est invalide.</div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="small mb-1" for="address">Adresse</label>
                      <input class="form-control" id="address" formControlName="address" placeholder="Entrez adresse">
                      <div *ngIf="forminput.get('address')?.touched && forminput.get('address')?.invalid" class="text-danger">
                        <div *ngIf="forminput.get('address')?.errors?.['required']">L'adresse est requise.</div>
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="small mb-1" for="password">Mot de passe</label>
                      <input class="form-control" id="password" formControlName="password" placeholder="Entrez mot de passe">
                      <div *ngIf="forminput.get('password')?.touched && forminput.get('password')?.invalid" class="text-danger">
                        <div *ngIf="forminput.get('password')?.errors?.['required']">Le mot de passe est requis.</div>
                      </div>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" aria-label="Close" (click)="closeEvent()">Annuler</button>
                      <button type="submit" class="btn btn-primary">Ajouter</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  

<!-- Modif Modal -->
<div class="modal fade" id="ModifModel" tabindex="-1" role="dialog" aria-labelledby="ModifModelLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="ModifModelLabel">Modifier un étudiant</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" (click)="closeModif()">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <div class="container-xl px-4 mt-4">
                  <hr class="mt-0 mb-4">
                  <div class="row">
                      <div class="col-xl-4">
                          <div class="card mb-4 mb-xl-0">
                              <div class="card-header">Photo de profil</div>
                              <div class="card-body text-center">
                                <img class="img-account-profile rounded-circle mb-2" [src]="selectedFile" alt="">
                                <br><input type="file" class="form-control" (change)="onFileSelected($event)"> <br><br>
                              </div>
                          </div>
                      </div>    
                    
                      <div class="col-xl-8">
                          <div class="card mb-4">
                              <div class="card-header">Détails du Compte</div>
                              <div class="card-body">
                                  <form>
                                      <div class="row gx-3 mb-3">
                                          <div class="col-md-6">
                                              <label class="small mb-1" for="firstname">Nom</label>
                                              <input class="form-control" id="firstname" type="text" [(ngModel)]="userToUpdate.firstname" name="firstname">
                                          </div>
                                          <div class="col-md-6">
                                              <label class="small mb-1" for="lastname">Prénom</label>
                                              <input class="form-control" id="lastname" type="text" [(ngModel)]="userToUpdate.lastname" name="lastname">
                                          </div>
                                      </div>
                                      <div class="mb-3">
                                        <label class="small mb-1" for="username">Nom d'utilisateur</label>
                                        <input class="form-control" id="username" type="text" [(ngModel)]="userToUpdate.username" name="username">
                                    </div>

                                      <div class="mb-3">
                                          <label class="small mb-1" for="email">Email</label>
                                          <input class="form-control" id="email" type="email" [(ngModel)]="userToUpdate.email" name="email">
                                      </div>

                                      <div class="mb-3">
                                          <label class="small mb-1" for="address">Adresse</label>
                                          <input class="form-control" id="address" type="text" [(ngModel)]="userToUpdate.address" name="address">
                                      </div>

                                      <div class="mb-3">
                                        <label class="small mb-1" for="password">Mot de passe</label>
                                        <input class="form-control" id="password" type="text" [(ngModel)]="userToUpdate.password" name="password">
                                    </div>
                                  </form>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-primary" (click)="modifEvent()">Modifier</button>
              <button type="button" class="btn btn-secondary" (click)="closeModif()">Fermer</button>
          </div>
      </div>
  </div>
</div>



<!-- Détails Modal -->
<div class="modal fade" id="detailsModel" tabindex="-1" role="dialog" aria-labelledby="detailsModelLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="detailsModelLabel">Détails du étudiant</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" (click)="closeDetails()">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <div class="container-xl px-4 mt-4">
                  <hr class="mt-0 mb-4">
                  <div class="row">
                      <div class="col-xl-8">
                          <div class="card mb-4">
                              <div class="card-body">
                                  <form>
                                      <div class="row gx-3 mb-3">
                                          <div class="col-md-6">
                                              <label class="small mb-1" for="detailsFirstName">Nom</label>
                                              <input class="form-control" id="detailsFirstName" type="text" readonly [value]="userToShow?.firstname">
                                          </div>
                                          <div class="col-md-6">
                                              <label class="small mb-1" for="detailsLastName">Prénom</label>
                                              <input class="form-control" id="detailsLastName" type="text" readonly [value]="userToShow?.lastname">
                                          </div>
                                      </div>
                                      <div class="mb-3">
                                          <label class="small mb-1" for="detailsEmailAddress">Adresse e-mail</label>
                                          <input class="form-control" id="detailsEmailAddress" type="email" readonly [value]="userToShow?.email">
                                      </div>
                                      <div class="mb-3">
                                          <label class="small mb-1" for="detailsAddress">Adresse</label>
                                          <textarea class="form-control" id="detailsAddress" rows="3" readonly>{{ userToShow?.address }}</textarea>
                                      </div>
                                  </form>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" (click)="closeDetails()">Fermer</button>
          </div>
      </div>
  </div>
</div>


<!-- Modal Supprimer -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModelLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
          <div class="modal-header delete-header"> <!-- Ajoutez la classe ici -->
              <h5 class="modal-title" id="deleteModelLabel">Supprimer un étudiant</h5>
              <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close" (click)="closeDelete()">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <p>Êtes-vous sûr de vouloir supprimer ce étudiant ? Cette action est irréversible.</p>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-danger" (click)="deleteEvent()">Supprimer</button>
              <button type="button" class="btn btn-secondary" (click)="closeDelete()">Annuler</button>
          </div>
      </div>
  </div>
</div>
